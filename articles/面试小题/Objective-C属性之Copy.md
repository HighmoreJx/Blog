# copy
è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯çœ‹[iOS ä¸­çš„ Copying](https://joeshang.github.io/),ç„¶åå°ç»“ä¸€ä¸‹.

## è‡ªé—®è‡ªç­”

ğŸ§ ä»€ä¹ˆæ˜¯æ‹·è´?  
ğŸ˜ƒ : ä¸€æ¨¡ä¸€æ ·çš„æ¥ä¸€ä»½å‘—.   

ğŸ§ æ‹·è´çš„åœºæ™¯æ˜¯å•¥?  
ğŸ˜ƒ: æˆ‘ä»¬å›åˆ°ç†Ÿæ‚‰çš„æŠ„ä½œä¸š. æ¯å½“æš‘å‡è¦å®Œçš„æ—¶å€™, æˆ‘ä»¬æ€»ä¼šåœ¨ä¸´è¿‘å‰çš„æœ€åä¸€å¤©ç–¯ç‹‚æŠ„å¤§ä½¬çš„ä½œä¸š. è¿™ä¸ªå°±æ˜¯æ‹·è´æœ€å¥½çš„ä¾‹å­äº†.    
ğŸ§  ä¸€æ¨¡ä¸€æ ·ä¼šä¸ä¼šè¢«è€å¸ˆæŠ“?
ğŸ¤«: å’³å’³. å¯¹, æŠ“ç´§æ”¹å‡ é“é¢˜çš„ç­”æ¡ˆ. ä½ çš„æ”¹åŠ¨ä¼šä¸ä¼šå½±å“åˆ°å¤§ä½¬çš„é‚£ä»½? æ˜¾ç„¶æ˜¯ä¸ä¼šçš„.    
ğŸ˜¶ æˆ‘å¤´é“, æˆ‘ä¸€ä¸ªå­—éƒ½ä¸æƒ³æ”¹.  
ğŸ˜ˆ: ä½ æ˜¯åœ¨æŒ‘æˆ˜è€å¸ˆçš„æ™ºå•†å—? åå­—éƒ½æŠ„ä¸€æ ·çš„.ä½ è¿™æ‹·è´æ¯«æ— æ„ä¹‰, ç»“å±€éƒ½æ˜¯GG.  

ğŸ‘¨â€ğŸ« : æ‹·è´çš„ä¸»è¦ç›®çš„æ˜¯ç”¨äºæ‹·è´ä¸€ä»½æ–°çš„æ•°æ®è¿›è¡Œä¿®æ”¹, è€Œä¸ä¼šå½±å“åˆ°åŸæ¥çš„æ•°æ®.å¦‚æœä¸ä¿®æ”¹, æ‹·è´å°±æ²¡æœ‰å¿…è¦. 

## Objective-C ä¸­çš„æ‹·è´
ä¸¾ä¸ªğŸŒ°:
```
NSInteger b = 3;
NSInteger a = b;
a = 5;
```
NSIntegeræ˜¯å€¼ç±»å‹, ä¸Šé¢å°±æ˜¯æœ€ç®€å•çš„ä¸€æ¬¡æ‹·è´.

ä¸¾ä¸ªğŸ:
```
@interface Person : NSObject
@property (nonatomic, assign) int age;
@property (nonatomic, strong) NSMuatableString *name;
@end

Person *person1 = [[Person alloc] init];
Person *person2 = person1;
```
ğŸ¤¥ è¿™æ˜¯OCå¯¹è±¡çš„æ‹·è´.

```
person1.age = 10;
person2. age = 20;
```

æœ€åå‘ç° ~ person1 å’Œ person2 å±…ç„¶åŒå²äº†â€¦  
ğŸ§ æˆ‘ä»¬è¯´è¿‡, æ‹·è´çš„æ„å›¾åœ¨äºäº§ç”Ÿä¸€ä»½ç›¸åŒçš„æ•°æ®, ç„¶åå¯ä»¥ä»»æ„ä¿®æ”¹ä¸”ä¸å½±å“åŸå§‹ç‰ˆæœ¬. å¾ˆæ˜æ˜¾ä¸Šé¢çš„ä¾‹å­æ ¹æœ¬ä¸ç¬¦åˆæ¡ä»¶. æ‰€ä»¥æ ¹æœ¬ä¸æ˜¯æ‹·è´.  

ä¸¥è‚ƒä¸€ç‚¹çœ‹ä¸‹å®˜ç½‘:  [Object copying](https://developer.apple.com/library/archive/documentation/General/Conceptual/DevPedia-CocoaCore/ObjectCopying.html)  
æˆ‘ä»¬ä¸»è¦å…³æ³¨ä¸€å¥è¯: 
>  If you receive an object from elsewhere in an application but do not copy it, you share the object with its owner (and perhaps others), who might change the encapsulated contents  

ç®€å•æ¥è¯´, ä¸Šé¢çš„ä¾‹å­åªæ˜¯å¤šäº†ä¸€ä¸ªæŒæœ‰å…³ç³», æ ¹æœ¬ä¸æ˜¯æ‹·è´! åªæœ‰ä¸¤ä¸ªå€¼ç±»å‹å¯¹è±¡çš„èµ‹å€¼æ‰å®Œå…¨ç¬¦åˆæˆ‘ä»¬å¯¹æ‹·è´çš„è®¤çŸ¥.

ğŸ˜³ å¾ˆæ‡µé€¼, é‚£OCå¯¹è±¡è¦æ€ä¹ˆæ‹·è´? 
ğŸ§ æ˜¯æ—¶å€™çœ‹çœ‹[è‹¹æœå®˜æ–¹æ–‡æ¡£]([NSCopying - Foundation | Apple Developer Documentation](https://developer.apple.com/documentation/foundation/nscopying?language=objc))äº†.  

ğŸ˜€ ç®€å•æ¥è¯´, å°±æ˜¯è¦å®ç°NSCoyingåè®®.  
```
#import "Person.h"

@interface Person()<NSCopying>
@end

@implementation Person
- (id)init {
    if (self = [super init]) {
        _name = [[NSMutableString alloc] initWithString:@"mike"];
    }
    return self;
}

- (id)copyWithZone:(NSZone *)zone {
    Person *object = [[[self class] allocWithZone:zone] init];
    object.name = _name;
    object.age = _age;
    return object;
}
@end

Person *person1 = [[Person alloc] init];
Person *person2 = [person1 copy];
person1.age = 10;
person2.age = 20;
```
è¿™ä¸ªæ—¶å€™é€šè¿‡è¾“å‡º, æˆ‘ä»¬å¯ä»¥å‘ç°ä¸¤ä¸ªäººçš„å¹´çºªå·²ç»ä¸åŒäº†.

ğŸ˜ƒ è¿™å®Œå…¨ç¬¦åˆæˆ‘ä»¬å¯¹æ‹·è´çš„å®šä¹‰. ç¨‹åºä»å †ä¸­å¼€è¾Ÿå‡ºäº†å®Œå…¨ç‹¬ç«‹çš„ç©ºé—´é‡æ–°æ„é€ äº†person2å¯¹è±¡. æˆ‘ä»¬å¯¹person2çš„æ“ä½œå®Œå…¨ç‹¬ç«‹ä¸person1.

ğŸ˜ˆä¸€åˆ‡çœŸçš„è¿™ä¹ˆç®€å•å—?
```
[person2.name insertString:@"funny " atIndex:0];
```
çµå¼‚çš„äº‹æƒ…å‘ç”Ÿäº†, person1ä¹Ÿè¢«æ”¹äº†.è¿™å°±å®Œå…¨ä¸ç¬¦åˆæ‹·è´çš„æ„å›¾äº†.  

é‚£ä¹ˆé—®é¢˜å‡ºåœ¨å“ªé‡Œäº†å‘¢?  
`object.name = _name;`  
ä¸Šé¢è¯´è¿‡è¿™ä¸ªæ ¹æœ¬ä¸æ˜¯æ‹·è´, è¿™æ˜¯å¤šäº†ä¸€ä¸ªæŒæœ‰å…³ç³»è€Œå·²(å¤šäº†ä¸€ä¸ªå¼•ç”¨).ç›¸å½“äºä¸€ä¸ªç›’å­æœ‰ä¸¤æŠŠé’¥åŒ™, ç›’å­é‡Œé¢è£…çš„ä¸œè¥¿å˜äº†, é‚£éšä¾¿ä½ ç”¨å“ªæŠŠé’¥åŒ™æ‰“å¼€ç›’å­, æœ€åé‡Œé¢çš„ä¸œè¥¿è‚¯å®šæ˜¯æœ€æ–°æ”¾å…¥çš„.  
æŒ‡é’ˆå¯¹è±¡è™½ç„¶è¢«æ‹·è´äº†, ä½†ä¸¤è€…è¿˜æ˜¯æŒ‡å‘åŒä¸€å—å†…å­˜ç©ºé—´.  

### æ·±æ‹·è´ä¸æµ…æ‹·è´

![object copy](https://joeshang.github.io/images/blog/ios-object-copy.png)

ä¸Šé¢æ˜¯è‹¹æœå®˜æ–¹æ–‡æ¡£çš„ä¸€å¹…å›¾, å›¾ä¸­å·¦ä¾§å°±å¾ˆæ¸…æ™°çš„å±•ç¤ºäº†æˆ‘ä»¬ä¸Šé¢æ‰€æè¿°çš„person.nameçš„åœºæ™¯.  
åŒæ—¶æˆ‘ä»¬æ³¨æ„åˆ°, å›¾ä¸­å³ä¾§è¿˜æœ‰ä¸€å‰¯å¯¹æ¯”å›¾.ä¸¤å¹…å›¾åˆ†åˆ«å¯¹åº”äº†ç¨‹åºå¼€å‘çš„æµ…å¤åˆ¶ä¸æ·±å¤åˆ¶.  

æµ…å¤åˆ¶: æŒ‡é’ˆæ‹·è´, ä»…ä»…æ‹·è´æŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆ  
æ·±å¤åˆ¶: å†…å®¹æ‹·è´, ä¼šæ‹·è´å¯¹è±¡æœ¬èº«  



## åŸºç¡€æ¦‚å¿µ



